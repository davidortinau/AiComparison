<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:AiComparison.ViewModels"
             xmlns:fs="clr-namespace:FlagstoneUI.Core.Controls;assembly=FlagstoneUI.Core"
             x:Class="AiComparison.MainPage"
             x:DataType="vm:MainViewModel"
             Title="AI Comparison"
             Shell.NavBarIsVisible="false"
             BackgroundColor="{DynamicResource Color.Surface}">

       <Grid RowDefinitions="Auto,*,Auto"
             Padding="16">

              <!-- Header -->
              <VerticalStackLayout Grid.Row="0"
                                   Spacing="4"
                                   Padding="0,8,0,16">
                     <Label Text="AI Summarization"
                            FontSize="{DynamicResource FontSize.HeadlineMedium}"
                            TextColor="{DynamicResource Color.OnSurface}"
                            HorizontalOptions="Center"/>
                     <Label Text="Compare local, cloud, and hybrid AI approaches"
                            FontSize="{DynamicResource FontSize.BodyMedium}"
                            TextColor="{DynamicResource Color.OnSurface}"
                            HorizontalOptions="Center"
                            Opacity="0.7"/>

                     <!-- Scenario Selector -->
                     <fs:FsCard Style="{StaticResource OutlinedCard}"
                                Padding="8"
                                Margin="0,8,0,0">
                            <Grid ColumnDefinitions="Auto,*,*"
                                  ColumnSpacing="12">
                                   <Label Text="Scenario:"
                                          FontSize="{DynamicResource FontSize.BodyMedium}"
                                          TextColor="{DynamicResource Color.OnSurface}"
                                          VerticalOptions="Center"
                                          FontAttributes="Bold"/>
                                   <fs:FsButton Grid.Column="1"
                                                Text="⚡ Power"
                                                Style="{Binding IsPowerScenario, Converter={StaticResource BoolToButtonStyleConverter}}"
                                                Clicked="OnPowerScenarioClicked"
                                                x:Name="PowerScenarioButton"/>
                                   <fs:FsButton Grid.Column="2"
                                                Text="🔒 Privacy"
                                                Style="{Binding IsPrivacyScenario, Converter={StaticResource BoolToButtonStyleConverter}}"
                                                Clicked="OnPrivacyScenarioClicked"
                                                x:Name="PrivacyScenarioButton"/>
                            </Grid>
                     </fs:FsCard>
                     <Label Text="{Binding ScenarioDescription}"
                            FontSize="12"
                            TextColor="{DynamicResource Color.OnSurface}"
                            HorizontalOptions="Center"
                            Opacity="0.6"/>
              </VerticalStackLayout>

              <Grid Grid.Row="1"
                    RowDefinitions="Auto,*,Auto,Auto">

                     <!-- Tab Selector -->
                     <fs:FsCard Grid.Row="0"
                                Style="{StaticResource OutlinedCard}"
                                Padding="4"
                                Margin="0,0,0,16">
                            <Grid ColumnDefinitions="*,*,*,*"
                                  ColumnSpacing="4">
                                   <fs:FsButton Text="🏠 Local"
                                                Style="{StaticResource TonalButton}"
                                                Clicked="OnLocalTabClicked"
                                                x:Name="LocalTabButton"/>
                                   <fs:FsButton Grid.Column="1"
                                                Text="☁️ Cloud"
                                                Style="{StaticResource TextButton}"
                                                Clicked="OnCloudTabClicked"
                                                x:Name="CloudTabButton"/>
                                   <fs:FsButton Grid.Column="2"
                                                Text="🔀 Hybrid"
                                                Style="{StaticResource TextButton}"
                                                Clicked="OnHybridTabClicked"
                                                x:Name="HybridTabButton"/>
                                   <fs:FsButton Grid.Column="3"
                                                Text="🏆 Final"
                                                Style="{StaticResource TextButton}"
                                                Clicked="OnFinalTabClicked"
                                                IsEnabled="{Binding CanCompare}"
                                                x:Name="FinalTabButton"/>
                            </Grid>
                     </fs:FsCard>

                     <ScrollView Grid.Row="1">
                            <VerticalStackLayout Spacing="8">

                                   <!-- Input Section -->
                                   <fs:FsCard Style="{StaticResource OutlinedCard}"
                                              Margin="0,0,0,16">
                                          <Grid RowDefinitions="Auto,Auto"
                                                RowSpacing="8">

                                                 <!-- Power Scenario: URL input -->
                                                 <Grid ColumnDefinitions="*,Auto"
                                                       ColumnSpacing="8"
                                                       IsVisible="{Binding IsPowerScenario}">
                                                        <fs:FsEntry Text="{Binding ContentUrl}"
                                                                    Placeholder="Enter URL to load content from..."
                                                                    VerticalOptions="Center"/>
                                                        <HorizontalStackLayout Grid.Column="1"
                                                                               Spacing="8">
                                                               <fs:FsButton Text="Load"
                                                                            Style="{StaticResource TonalButton}"
                                                                            Command="{Binding LoadSampleTextCommand}"
                                                                            IsEnabled="{Binding IsLoadingContent, Converter={StaticResource InvertedBoolConverter}}"
                                                                            WidthRequest="80"/>
                                                               <ActivityIndicator IsRunning="{Binding IsLoadingContent}"
                                                                                  IsVisible="{Binding IsLoadingContent}"
                                                                                  HeightRequest="20"
                                                                                  WidthRequest="20"
                                                                                  Color="{DynamicResource Color.Primary}"/>
                                                        </HorizontalStackLayout>
                                                 </Grid>

                                                 <!-- Privacy Scenario: Load Health Record -->
                                                 <Grid ColumnDefinitions="*,Auto"
                                                       ColumnSpacing="8"
                                                       IsVisible="{Binding IsPrivacyScenario}">
                                                        <Label Text="📋 Sample Patient Health Record"
                                                               FontSize="{DynamicResource FontSize.TitleMedium}"
                                                               TextColor="{DynamicResource Color.OnSurface}"
                                                               FontAttributes="Bold"
                                                               VerticalOptions="Center"/>
                                                        <HorizontalStackLayout Grid.Column="1"
                                                                               Spacing="8">
                                                               <fs:FsButton Text="Load Record"
                                                                            Style="{StaticResource TonalButton}"
                                                                            Command="{Binding LoadHealthRecordCommand}"
                                                                            WidthRequest="120"/>
                                                               <Label Text="{Binding WordCount, StringFormat='{0} words'}"
                                                                      FontSize="{DynamicResource FontSize.BodyMedium}"
                                                                      TextColor="{DynamicResource Color.Primary}"
                                                                      IsVisible="{Binding HasContent}"
                                                                      VerticalOptions="Center"/>
                                                        </HorizontalStackLayout>
                                                 </Grid>

                                                 <Label Text="Input Text"
                                                        Grid.Row="1"
                                                        IsVisible="{Binding IsPowerScenario}"
                                                        FontSize="{DynamicResource FontSize.TitleMedium}"
                                                        TextColor="{DynamicResource Color.OnSurface}"
                                                        FontAttributes="Bold"/>
                                                 <Label Text="{Binding WordCount, StringFormat='{0} words'}"
                                                        Grid.Row="1"
                                                        HorizontalOptions="End"
                                                        VerticalOptions="End"
                                                        FontSize="{DynamicResource FontSize.BodyMedium}"
                                                        TextColor="{DynamicResource Color.Primary}"
                                                        IsVisible="{Binding HasContent}"/>

                                                 <fs:FsEditor Grid.Row="1"
                                                              Margin="0,20,0,0"
                                                              Text="{Binding InputText}"
                                                              Placeholder="Enter or paste text to summarize..."
                                                              HeightRequest="200"
                                                              IsVisible="{Binding IsPowerScenario}"/>

                                                 <!-- Collapsed view for health record in Privacy mode -->
                                                 <fs:FsCard Grid.Row="1"
                                                            Style="{StaticResource OutlinedCard}"
                                                            Padding="8"
                                                            MaximumHeightRequest="100"
                                                            IsVisible="{Binding IsPrivacyScenario}">
                                                        <ScrollView>
                                                               <Label Text="{Binding InputText}"
                                                                      FontSize="11"
                                                                      TextColor="{DynamicResource Color.OnSurface}"
                                                                      Opacity="0.7"
                                                                      LineBreakMode="WordWrap"/>
                                                        </ScrollView>
                                                 </fs:FsCard>
                                          </Grid>
                                   </fs:FsCard>

                                   <!-- Question Picker (Privacy mode only) -->
                                   <fs:FsCard Style="{StaticResource OutlinedCard}"
                                              Padding="12"
                                              Margin="0,0,0,16"
                                              IsVisible="{Binding IsPrivacyScenario}">
                                          <Grid RowDefinitions="Auto,Auto"
                                                RowSpacing="4">
                                                 <Label Text="Select a question to ask:"
                                                        FontSize="{DynamicResource FontSize.TitleMedium}"
                                                        TextColor="{DynamicResource Color.OnSurface}"
                                                        FontAttributes="Bold"/>
                                                 <Picker Grid.Row="1"
                                                         ItemsSource="{Binding HealthQuestions}"
                                                         SelectedItem="{Binding SelectedQuestion}"
                                                         Title="Choose a question..."/>
                                          </Grid>
                                   </fs:FsCard>

                                   <!-- Output Section -->
                                   <fs:FsCard Style="{StaticResource OutlinedCard}"
                                              Margin="0,0,0,16">
                                          <Grid RowDefinitions="Auto,*"
                                                RowSpacing="8">
                                                 <HorizontalStackLayout Spacing="8">
                                                        <Label Text="{Binding OutputSectionTitle}"
                                                               FontSize="{DynamicResource FontSize.TitleMedium}"
                                                               TextColor="{DynamicResource Color.OnSurface}"
                                                               FontAttributes="Bold"/>
                                                        <ActivityIndicator IsRunning="{Binding IsProcessing}"
                                                                           IsVisible="{Binding IsProcessing}"
                                                                           HeightRequest="16"
                                                                           WidthRequest="16"
                                                                           Color="{DynamicResource Color.Primary}"/>
                                                 </HorizontalStackLayout>

                                                 <fs:FsEditor HeightRequest="200"
                                                              Grid.Row="1"
                                                              Text="{Binding OutputText}"/>
                                          </Grid>
                                   </fs:FsCard>

                                   <!-- Benchmark Comparison Panel -->
                                   <fs:FsCard Style="{StaticResource ElevatedCard}"
                                              BackgroundColor="{DynamicResource Color.PrimaryContainer}">
                                          <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto"
                                                RowSpacing="8">
                                                 <Label Text="📊 Benchmark Comparison"
                                                        FontSize="{DynamicResource FontSize.TitleMedium}"
                                                        TextColor="{DynamicResource Color.OnPrimaryContainer}"
                                                        FontAttributes="Bold"/>

                                                 <!-- Header Row -->
                                                 <Grid Grid.Row="1"
                                                       ColumnDefinitions="100,*,*,*"
                                                       ColumnSpacing="8"
                                                       Padding="0,8,0,4">
                                                        <Label Text="Metric"
                                                               Style="{StaticResource BenchmarkLabel}"
                                                               FontAttributes="Bold"/>
                                                        <Label Grid.Column="1"
                                                               Text="🏠 Local"
                                                               Style="{StaticResource BenchmarkLabel}"
                                                               FontAttributes="Bold"
                                                               HorizontalTextAlignment="End"/>
                                                        <Label Grid.Column="2"
                                                               Text="☁️ Cloud"
                                                               Style="{StaticResource BenchmarkLabel}"
                                                               FontAttributes="Bold"
                                                               HorizontalTextAlignment="End"/>
                                                        <Label Grid.Column="3"
                                                               Text="🔀 Hybrid"
                                                               Style="{StaticResource BenchmarkLabel}"
                                                               FontAttributes="Bold"
                                                               HorizontalTextAlignment="End"/>
                                                 </Grid>

                                                 <!-- Total Time Row -->
                                                 <Grid Grid.Row="2"
                                                       ColumnDefinitions="100,*,*,*"
                                                       ColumnSpacing="8">
                                                        <Label Text="Total (ms)"
                                                               Style="{StaticResource BenchmarkLabel}"
                                                               VerticalOptions="Center"/>
                                                        <Label Grid.Column="1"
                                                               Text="{Binding LocalBenchmark.TotalTimeMs, StringFormat='{0:N0}'}"
                                                               Style="{StaticResource BenchmarkValue}"
                                                               FontAttributes="{Binding IsLocalBestTime, Converter={StaticResource BoolToFontAttributeConverter}}"/>
                                                        <Label Grid.Column="2"
                                                               Text="{Binding CloudBenchmark.TotalTimeMs, StringFormat='{0:N0}'}"
                                                               Style="{StaticResource BenchmarkValue}"
                                                               FontAttributes="{Binding IsCloudBestTime, Converter={StaticResource BoolToFontAttributeConverter}}"/>
                                                        <Label Grid.Column="3"
                                                               Text="{Binding HybridBenchmark.TotalTimeMs, StringFormat='{0:N0}'}"
                                                               Style="{StaticResource BenchmarkValue}"
                                                               FontAttributes="{Binding IsHybridBestTime, Converter={StaticResource BoolToFontAttributeConverter}}"/>
                                                 </Grid>

                                                 <!-- First Token Row -->
                                                 <Grid Grid.Row="3"
                                                       ColumnDefinitions="100,*,*,*"
                                                       ColumnSpacing="8">
                                                        <Label Text="First Token (ms)"
                                                               Style="{StaticResource BenchmarkLabel}"
                                                               VerticalOptions="Center"/>
                                                        <Label Grid.Column="1"
                                                               Text="{Binding LocalBenchmark.FirstTokenLatencyMs, StringFormat='{0:N0}'}"
                                                               Style="{StaticResource BenchmarkValue}"
                                                               FontAttributes="{Binding IsLocalBestFirstToken, Converter={StaticResource BoolToFontAttributeConverter}}"/>
                                                        <Label Grid.Column="2"
                                                               Text="{Binding CloudBenchmark.FirstTokenLatencyMs, StringFormat='{0:N0}'}"
                                                               Style="{StaticResource BenchmarkValue}"
                                                               FontAttributes="{Binding IsCloudBestFirstToken, Converter={StaticResource BoolToFontAttributeConverter}}"/>
                                                        <Label Grid.Column="3"
                                                               Text="{Binding HybridBenchmark.FirstTokenLatencyMs, StringFormat='{0:N0}'}"
                                                               Style="{StaticResource BenchmarkValue}"
                                                               FontAttributes="{Binding IsHybridBestFirstToken, Converter={StaticResource BoolToFontAttributeConverter}}"/>
                                                 </Grid>

                                                 <!-- Tokens/sec Row -->
                                                 <Grid Grid.Row="4"
                                                       ColumnDefinitions="100,*,*,*"
                                                       ColumnSpacing="8">
                                                        <Label Text="Tokens/sec"
                                                               Style="{StaticResource BenchmarkLabel}"
                                                               VerticalOptions="Center"/>
                                                        <Label Grid.Column="1"
                                                               Text="{Binding LocalBenchmark.TokensPerSecond, StringFormat='{0:N1}'}"
                                                               Style="{StaticResource BenchmarkValue}"
                                                               FontAttributes="{Binding IsLocalBestTokensPerSec, Converter={StaticResource BoolToFontAttributeConverter}}"/>
                                                        <Label Grid.Column="2"
                                                               Text="{Binding CloudBenchmark.TokensPerSecond, StringFormat='{0:N1}'}"
                                                               Style="{StaticResource BenchmarkValue}"
                                                               FontAttributes="{Binding IsCloudBestTokensPerSec, Converter={StaticResource BoolToFontAttributeConverter}}"/>
                                                        <Label Grid.Column="3"
                                                               Text="{Binding HybridBenchmark.TokensPerSecond, StringFormat='{0:N1}'}"
                                                               Style="{StaticResource BenchmarkValue}"
                                                               FontAttributes="{Binding IsHybridBestTokensPerSec, Converter={StaticResource BoolToFontAttributeConverter}}"/>
                                                 </Grid>

                                                 <!-- Memory Row -->
                                                 <Grid Grid.Row="5"
                                                       ColumnDefinitions="100,*,*,*"
                                                       ColumnSpacing="8">
                                                        <Label Text="Memory Δ (MB)"
                                                               Style="{StaticResource BenchmarkLabel}"
                                                               VerticalOptions="Center"/>
                                                        <Label Grid.Column="1"
                                                               Text="{Binding LocalBenchmark.MemoryDeltaMB, StringFormat='{0:N2}'}"
                                                               Style="{StaticResource BenchmarkValue}"
                                                               FontAttributes="{Binding IsLocalBestMemory, Converter={StaticResource BoolToFontAttributeConverter}}"/>
                                                        <Label Grid.Column="2"
                                                               Text="{Binding CloudBenchmark.MemoryDeltaMB, StringFormat='{0:N2}'}"
                                                               Style="{StaticResource BenchmarkValue}"
                                                               FontAttributes="{Binding IsCloudBestMemory, Converter={StaticResource BoolToFontAttributeConverter}}"/>
                                                        <Label Grid.Column="3"
                                                               Text="{Binding HybridBenchmark.MemoryDeltaMB, StringFormat='{0:N2}'}"
                                                               Style="{StaticResource BenchmarkValue}"
                                                               FontAttributes="{Binding IsHybridBestMemory, Converter={StaticResource BoolToFontAttributeConverter}}"/>
                                                 </Grid>
                                          </Grid>
                                   </fs:FsCard>
                            </VerticalStackLayout>
                     </ScrollView>
              </Grid>


              <!-- Bottom Action Bar -->
              <Grid Grid.Row="2"
                    ColumnDefinitions="*,Auto,Auto"
                    ColumnSpacing="12"
                    Padding="0,16,0,0">
                     <Label Text="{Binding StatusMessage}"
                            FontSize="{DynamicResource FontSize.BodyMedium}"
                            TextColor="{DynamicResource Color.OnSurface}"
                            VerticalOptions="Center"
                            Opacity="0.8"/>

                     <fs:FsButton Grid.Column="1"
                                  Text="Clear"
                                  Style="{StaticResource OutlinedButton}"
                                  Command="{Binding ClearOutputCommand}"
                                  IsEnabled="{Binding IsProcessing, Converter={StaticResource InvertedBoolConverter}}"/>

                     <fs:FsButton Grid.Column="2"
                                  Command="{Binding SummarizeCommand}"
                                  CommandParameter="{Binding .}"
                                  IsEnabled="{Binding InputText.Length}">
                            <fs:FsButton.Text>
                                   <MultiBinding Converter="{StaticResource ProcessingButtonTextConverter}">
                                          <Binding Path="IsProcessing"/>
                                          <Binding Path="ActionButtonText"/>
                                   </MultiBinding>
                            </fs:FsButton.Text>
                     </fs:FsButton>
              </Grid>
       </Grid>

</ContentPage>
